<!DOCTYPE html>
<html>

<head>
    <title>Firebase Sign-In & Fetch Bills</title>
    <script type="module">
        // 1. Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { getFirestore, collection, query, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        // 2. Your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDiofUHEJxWqYt25sO8bwz8dRLyZLMCoFE",
            authDomain: "everest-51e18.firebaseapp.com",
            projectId: "everest-51e18",
            storageBucket: "everest-51e18.appspot.com",
            messagingSenderId: "848124670146",
            appId: "1:848124670146:web:f7fc6f4d9e2a60b47ecb5b",
            measurementId: "G-TR7Z090WV9"
        };

        // 3. Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);


        // 4. Sign in user
        async function signInUser() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // Signed in 
                    const user = userCredential.user;
                    console.log(user.uid)
                    fetchAccountList();

                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                });
        }

        async function fetchAccountList() {
            try {
                // This matches your exact path
                const colRef = collection(
                    db,
                    "adminManagement",
                    "IIPMwsQfXSzrASo8qjFO",
                    "accounting",
                    "glAccounts",
                    "accountList"
                );

                const snapshot = await getDocs(colRef);

                const data = [];
                snapshot.forEach((doc) => {
                    data.push({ id: doc.id, ...doc.data() });
                });

                console.log("Account List data:", data);
                document.getElementById("output").textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                console.error("Error fetching account list:", error.message);
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("✅ Signed in:", user.email);
                console.log("✅ Signed in:", user.uid);
                const accountingDb = collection(db, "adminManagement", "IIPMwsQfXSzrASo8qjFO", "accounting", "glAccounts", "accountList");
                const querySnapshot = getDocs(accountingDb);
            } else {
                console.log("❌ Not signed in");
            }
        });


        // Expose function to global scope for HTML button
        window.signInUser = signInUser;
    </script>
</head>

<body>
    <h2>Firebase Sign-In and Fetch 'bills'</h2>
    <div>
        <input type="email" id="email" placeholder="Email"><br>
        <input type="password" id="password" placeholder="Password"><br>
        <button onclick="signInUser()">Sign In</button>
        <p id="status">Not signed in.</p>
    </div>

    <pre id="output">Data will appear here...</pre>
</body>

</html>